import{d as Se,c as R,b as D,t as Ce,a as c,_ as nt,n as ce,h as Fe,w as it,v as st,g as _r,A as dt,o as Pr,p as fe,x as Ne,i as ut,j as N,q as Or,N as ct,r as u,z as ft,J as mt,u as pt,e as ge,a5 as yt,s as vt,f as r,F as bt,E as gt,m as v}from"./entry.134d9327.js";import{u as ht}from"./composables.f48018c7.js";import{_ as _t,$ as kt,f as Re,R as Ft,u as kr,n as Fr,w as he,r as _e,S as Cr,T as Sr,U as Ct,V as St,W as wr}from"./index.537ec403.js";import{k as wt,n as Vt,o as Be,p as Me,q as It,r as Et,t as Pt,g as Ot,c as Dt,a as Ut,b as Tt,s as Vr,h as Ir,f as Er,u as $t,w as At,x as xt,y as Rt,z as Bt,A as Mt,B as Lt,C as Nt,D as jt,E as qt,F as zt,G as Ht,H as Jt,I as Wt,J as Kt,K as Yt,L as Gt,M as Qt,N as Xt,d as Zt,O as eo,P as ro}from"./TextElement.vue_vue_type_style_index_0_lang.54470764.js";import{u as to}from"./index.fe4d1c15.js";import{S as oo}from"./HLConst.3d8ad243.js";const ao={class:"col-md-12 col-sm-12 col-lg-12 text-center thank-you-message"},lo=Se({__name:"ThanksMessage",props:["payload"],setup(d){return(g,a)=>(c(),R("div",null,[D("div",ao,[D("h3",null,Ce(d.payload.message),1)])]))}});const no=nt(lo,[["__scopeId","data-v-b24783f1"]]),io=["type","disabled"],so={style:{position:"absolute",left:"50%",transform:"translate(-50%, -50%)",top:"50%"},class:"loader-submit"},uo=Se({__name:"ButtonElement",props:{item:{type:Object},calendar:{type:Object},formSubmitDisable:{type:Boolean},buttonStyle:{type:Object}},emits:["click"],setup(d,{expose:g,emit:a}){const B=d,U=function(){a("click")};return g({item:B.item}),(me,Z)=>{const C=wt;return c(),R("div",{class:"form-builder--item form-builder--btn-submit",style:Fe({textAlign:d.calendar?"center":d.item.align})},[D("div",{style:Fe([{width:d.item.fullwidth?"100%":"auto"},{display:"inline-block",position:"relative"}])},[D("button",{type:d.item.type,class:ce({invisible:d.formSubmitDisable,"btn btn-dark":!d.calendar,"hl_button --primary":d.calendar}),style:Fe({backgroundColor:"#"+d.buttonStyle.bgColor,color:"#"+d.buttonStyle.color,border:d.buttonStyle.border+"px solid #"+d.buttonStyle.borderColor,borderRadius:d.buttonStyle.radius+"px",padding:d.buttonStyle.padding+"px",width:d.item.fullwidth?"100%":"auto",whiteSpace:"normal"}),disabled:d.formSubmitDisable,onClick:U},Ce(d.item.label),15,io),it(D("div",so,[_r(C,null,{default:dt(()=>[_r(_t,{loading:d.formSubmitDisable,color:"#188bf6",size:"15px"},null,8,["loading"])]),_:1})],512),[[st,d.formSubmitDisable]])],4)],4)}}}),co={key:0,class:"menu-field-wrap col-12"},fo={class:"form-builder--item"},mo={key:0,class:"test-mode-badge"},po={key:1,class:"text-light"},yo={id:"card-element",ref:"card-element",class:"field"},vo={class:"outcome"},bo={key:0,class:"error",role:"alert"},go=Se({__name:"StripePaymentElement",props:{calendar:{type:Object},payment:{type:Object},stripe:{type:Object},card:{type:Object},cardErrorMsg:{type:String}},emits:["updateStripe","updateCard","updateCardErrorMsg"],setup(d,{emit:g}){const a=d;Pr(()=>{fe(()=>{B()})});const B=()=>{try{if(a.payment===void 0||!a.payment.publishable_key)return"";const C=a.payment.account_id?{stripeAccount:a.payment.account_id}:null,G=Stripe(a.payment.publishable_key,C);U(G);const we=G.elements().create("card",{style:oo,hidePostalCode:!0});me(we)}catch(C){console.log("payment",C)}},U=C=>{g("updateStripe",C)},me=C=>{g("updateCard",C)},Z=C=>{g("updateCardErrorMsg",C)};return Ne(()=>a.card,()=>{a.card.mount("#card-element"),a.card.addEventListener("change",C=>{C.error?Z(C.error.message):Z("")})}),(C,G)=>d.payment?(c(),R("div",co,[D("div",fo,[D("label",null,[ut(" Secure Payment "),d.calendar.payment_mode!==void 0&&d.calendar.payment_mode===!1?(c(),R("span",mo,"Test Mode")):N("",!0),d.payment.description?(c(),R("small",po,"("+Ce(d.payment.description)+")",1)):N("",!0)]),D("div",yo,null,512),D("div",vo,[d.cardErrorMsg?(c(),R("div",bo,Ce(d.cardErrorMsg),1)):N("",!0)])])])):N("",!0)}});let ke;const ho=()=>({channel:"APP",source:"WEB_USER",version:"2021-04-15"}),Le=d=>{const g=Or().public;return kt.create({baseURL:d||g.REST_API_URLS,headers:ho()})},_o={generateRRuleText:d=>Le()("calendars/generate-rrule-text",{method:"POST",body:d}),getRecurringSlots:(d,g)=>{ke&&ke.abort(),ke=new AbortController;const a=ke.signal;return Le()(`calendars/${d}/recurring-slots`,{params:g,signal:a})},createRecurringEvents:d=>Le()("calendars/events/recurring-appointments",{method:"POST",body:d})},ko={ref:"hl-app",class:"hl-app"},Eo=Se({__name:"FormComponent",props:{formId:{type:String,default:void 0},formData:{type:Object||Array,required:!0},calendar:{type:Object,default:void 0},selectedSlot:{type:Object,default:void 0},timezone:{type:String,default:void 0},event:{type:Object,default:void 0},error:{type:String,default:void 0},redirect:{type:Boolean,default:!0},funnelPreview:{type:Boolean,default:!1},formElementClass:{type:String,required:!1},calendarEventId:{type:String,required:!1},forCalendarV3:{type:Boolean,default:!1},pageUrl:{type:String,default:void 0},baseReferrrer:{type:String,default:void 0},urlParams:{type:Object,default:void 0},stickyContactData:{type:Object,default:void 0},stickyContactFingerprint:{type:String,default:void 0},iFrameId:{type:String,default:void 0}},emits:["step","processError","disableBackOnSubmit","onSubmit"],setup(d,{emit:g}){const a=d,{t:B}=ct(),U=Or();let me={},Z={},C={},G=u(!0),je={},we=u(!1),_=u([]),Dr={},Ur={},qe=u(""),Ve=u(!1),F=u(!0),Tr={},ze=u(!1),$r={},Ar={},ee=u(!1),h=u(""),Ie=u(!1),Ee=u("US"),pe=u(),re=u("");u("");let ye=u(""),xr=u([]),Q=u(!1),He=u(),te=u({}),Pe=u(!0),H=u(""),Oe=u(),ve=u(),De=u(),Ue=u(),V=u(),j=u(),oe=u(),Rr={},Te=u(),m=u([]),k=u(!1);const e=ft({phoneCountryIncluded:me,phoneCountryCode:C,formattedPhone:Z,form:je,formStyle:Dr,buttonStyle:Ur,company:Tr,formFieldsValue:$r,validationError:Ar,errors:Rr}),Br=()=>{var z,E,J,W,T,S,$,A,M,K,x,w,X,ae,le,ne,ie,se,de,l,p,b,P,f,y,L,ue,Y,Ge,Qe,Xe,Ze,er,rr,tr,or,ar,lr,nr,ir,sr,dr,ur,cr,fr,mr,pr,yr,vr,br,gr,hr;const{locationId:n,form:o,country:t}=a.formData;if(!n||!o)return;e.form=o,ye.value=(z=e.form)==null?void 0:z.fbPixelId,h.value=n,Ee.value=t,Q.value="stickyContact"in e.form?(E=e.form)==null?void 0:E.stickyContact:!1;const i=a.formElementClass?`.${a.formElementClass}${Sr}`:Sr;"layout"in e.form&&(Ve.value=(J=e.form)==null?void 0:J.layout),"fields"in e.form&&(_.value=[...(W=e.form)==null?void 0:W.fields]),"style"in e.form&&(e.formStyle={bgColor:(S=(T=e.form)==null?void 0:T.style)==null?void 0:S.background,color:(A=($=e.form)==null?void 0:$.style)==null?void 0:A.color,border:(x=(K=(M=e.form)==null?void 0:M.style)==null?void 0:K.border)==null?void 0:x.border,borderStyle:(ae=(X=(w=e.form)==null?void 0:w.style)==null?void 0:X.border)==null?void 0:ae.style,borderColor:(ie=(ne=(le=e.form)==null?void 0:le.style)==null?void 0:ne.border)==null?void 0:ie.color,radius:(l=(de=(se=e.form)==null?void 0:se.style)==null?void 0:de.border)==null?void 0:l.radius,width:(p=e.form)==null?void 0:p.width,marginTop:(P=(b=e.form)==null?void 0:b.style)==null?void 0:P.marginTop},ze.value=(y=(f=e.form)==null?void 0:f.style)==null?void 0:y.ac_branding),"button"in e.form&&(e.buttonStyle={bgColor:(ue=(L=e.form)==null?void 0:L.button)==null?void 0:ue.background,color:(Ge=(Y=e.form)==null?void 0:Y.button)==null?void 0:Ge.color,border:((Ze=(Xe=(Qe=e.form)==null?void 0:Qe.button)==null?void 0:Xe.border)==null?void 0:Ze.border)||0,borderColor:((tr=(rr=(er=e.form)==null?void 0:er.button)==null?void 0:rr.border)==null?void 0:tr.color)||Ct,radius:(lr=(ar=(or=e.form)==null?void 0:or.button)==null?void 0:ar.border)==null?void 0:lr.radius,padding:(sr=(ir=(nr=e.form)==null?void 0:nr.button)==null?void 0:ir.border)==null?void 0:sr.padding}),"customStyle"in e.form&&((ur=(dr=e.form)==null?void 0:dr.customStyle)==null?void 0:ur.length)>0&&(qe.value=e.form.customStyle),(cr=e.formStyle)!=null&&cr.color&&(He.value=`${i}label{ color:#${e.formStyle.color} !important }`),"company"in e.form&&(e.company=(fr=e.form)==null?void 0:fr.company),"formLabelVisible"in e.form&&(F.value=(mr=e.form)==null?void 0:mr.formLabelVisible);let s=(pr=e.form)==null?void 0:pr.payment;s||((yr=a.calendar)==null?void 0:yr.stripe)&&(((br=(vr=a.calendar)==null?void 0:vr.stripe)==null?void 0:br.amount)==0||((hr=(gr=a.calendar)==null?void 0:gr.stripe)==null?void 0:hr.currency))&&(s=a.calendar.stripe),s&&(Oe.value={publishable_key:s.publishable_key,account_id:s.account_id,amount:(parseFloat(s.amount)*100).toFixed(2),name:s.amount?"Pay to processed":"Verify your card",description:s.charge_description,currency:s.currency}),G.value=!1},$e=to(),O=mt(),{$bus:Je}=pt(),q=u([]),Mr=u(Vt(a.formData));Br(),ht({__dangerouslyDisableSanitizers:["style"],style:[{children:qe.value,type:"text/css"},{children:He.value,type:"text/css"}],link:[...Mr.value]});const Lr=ge(()=>St.find(n=>n.code===Ee.value)),We=ge(()=>pe.value||Ee.value),Nr=ge(()=>Object.values(Zt)),jr=ge(()=>e.formStyle.border==="0"?"form-top-padding":"");Pr(()=>{let n=!1;Be(a.urlParams,O,e.phoneCountryIncluded,V.value,e.formFieldsValue,_.value).then(o=>{e.phoneCountryIncluded=o.phoneCountryIncluded,e.formFieldsValue=o.formFieldsValue,V.value=o.formattedCountry,_.value=o.formFields}),_.value.map(o=>{if(o.type==="textbox_list"){const t={};o.picklistOptions.forEach(i=>{t[i.id]=i.prefillValue}),e.formFieldsValue[o.tag]=t}else o.type==="source"?e.formFieldsValue[o.tag]=o.value:o.type==="checkbox"&&!(e.formFieldsValue[o.tag]instanceof Array)?e.formFieldsValue[o.tag]=[]:o.type==="submit"&&(n=!0,a.calendar&&(o.label&&o.label.toLowerCase()==="button"||o.label.trim().length<=0)&&(o.label=B(a.forCalendarV3?"schedule_meeting":"book_appointment")))}),n||_.value.push({label:a.calendar?B(a.forCalendarV3?"schedule_meeting":"book_appointment"):B("submit"),tag:"button",palceholder:"button",type:"submit"}),!a.funnelPreview&&ye.value!==void 0&&ye.value!==""&&fe(()=>{At(ye.value,e.form.pageViewEvent)}),Q.value&&(q.value=_.value.map(o=>o.tag),Me(void 0,h.value,q.value,e.formFieldsValue,e.phoneCountryIncluded,V.value).then(o=>{o?(e.formFieldsValue=o.formFieldsValue,e.phoneCountryIncluded=o.phoneCountryIncluded,V.value=o.formattedCountry):console.warn("Data not found! skippping stickycontact fill")}).catch(o=>{console.error("Failed at fillDataFromCookie",o)})),_.value.length>0&&_.value.forEach((o,t)=>{if(o.type==="html"&&o&&"html"in o){const i=o.html.replace(/[‘’]/g,"'").replace(/[“”]/g,'"');xr.value.push({scriptString:i,index:t})}}),fe(()=>{we.value=!0}),H.value=Math.random().toString(36).slice(2),Je.$on("submitCalendarForm",xe),O.query.hasOwnProperty("sticky_contact_help")&&O.query.sticky_contact_help==="true"&&(console.log("%c Sticky Contact data","color: black; font-weight: bold; background-color: white"),console.log("%c ===================","color: black; font-weight: bold; background-color: white"),console.log(JSON.parse(Re("_ud"))),console.log("%c ===================","color: black; font-weight: bold; background-color: white")),a.urlParams&&Be(a.urlParams,O,e.phoneCountryIncluded,V.value,e.formFieldsValue,_.value).then(o=>{e.phoneCountryIncluded=o.phoneCountryIncluded,e.formFieldsValue=o.formFieldsValue,V.value=o.formattedCountry,_.value=o.formFields}),a.stickyContactData&&Q.value&&(q.value||(q.value=_.value.map(o=>o.tag)),Me(a.stickyContactData,h.value,q.value,e.formFieldsValue,e.phoneCountryIncluded,V.value).then(o=>{e.formFieldsValue=o.formFieldsValue,e.phoneCountryIncluded=o.phoneCountryIncluded,V.value=o.formattedCountry}).catch(o=>{console.error("Failed at fillDataFromCookie at sticky contact",o)})),k.value=!0}),yt(()=>{m.value=[]}),Ne(()=>a.urlParams,(n,o)=>{a.urlParams&&Be(a.urlParams,O,e.phoneCountryIncluded,V.value,e.formFieldsValue,_.value).then(t=>{e.phoneCountryIncluded=t.phoneCountryIncluded,e.formFieldsValue=t.formFieldsValue,V.value=t.formattedCountry,_.value=t.formFields})}),Ne(()=>a.stickyContactData,(n,o)=>{a.stickyContactData&&Q.value&&(q.value||(q.value=_.value.map(t=>t.tag)),Me(a.stickyContactData,h.value,q.value,e.formFieldsValue,e.phoneCountryIncluded,V.value).then(t=>{e.formFieldsValue=t.formFieldsValue,e.phoneCountryIncluded=t.phoneCountryIncluded,V.value=t.formattedCountry}).catch(t=>{console.error("Failed at fillDataFromCookie at sticky contact",t)}))});const Ke=n=>{pe.value=n},qr=n=>{e.validationError=n},zr=n=>{ve.value=n},Hr=n=>{De.value=n},Jr=n=>{j.value=n},be=n=>{const{tag:o,value:t}=n;e.formFieldsValue[o]=t},Wr=n=>{V.value=n},Kr=n=>{oe.value=n},I=n=>{const{tag:o,error:t}=n;e.errors[o]=t,Ye()},Yr=n=>{Te.value=n},Gr=n=>{const{date:o,item:t}=n;e.formFieldsValue[t.tag]=o},Ae=n=>{const o=e.phoneCountryIncluded[n.tag],t=e.phoneCountryCode[n.tag];e.formFieldsValue[n.tag]=o,n.tag==="phone"&&(re.value=e.formFieldsValue[n.tag]);try{const i=window.libphonenumber.parsePhoneNumberFromString(o,t);e.phoneCountryIncluded[n.tag]=i.isValid()?i.number:o,e.phoneCountryCode[n.tag]=i.country?i.country:t,e.formattedPhone[n.tag]=i.isValid()?i.formatNational():o}catch{e.phoneCountryIncluded[n.tag]=o,e.formattedPhone[n.tag]=o}},Qr=()=>{let n=!1,o=0;return _.value.map(t=>{t.type==="cascade_dropdown"&&t.required&&e.formFieldsValue[t.tag]===void 0?(Pe.value=!1,n=!0):e.formFieldsValue[t.tag]!==void 0&&t.type==="cascade_dropdown"&&(e.formFieldsValue[t.tag].forEach(function(s){for(const z in s)s[z]===""&&o++}),o>0?(Pe.value=!1,n=!0):Pe.value=!0)}),n},Xr=async()=>{const n=m.value.map(t=>{t.validate&&t.validate()});return await Promise.all(n),await Ye()},Zr=async()=>{let n=!1;const o=m.value.map(t=>{var i,s;console.log("Element",(i=t==null?void 0:t.item)==null?void 0:i.type),((s=t==null?void 0:t.item)==null?void 0:s.type)==="captcha"&&(n=!0)});return await Promise.all(o),n},Ye=async()=>{const n=Object.values(e.errors);let o=!1;return await Promise.all(n.map(t=>{t&&(o=!0)})),o},et=n=>{let o=0,t=0;return _.value.map(function(i,s){wr.indexOf(i.type)<0&&(o++,t=s)}),o%2!==0&&_.value[t].tag===n},rt=n=>wr.indexOf(n)>=0,tt=n=>{e.formFieldsValue[n.tag]=""},ot=n=>{const{item:o,event:t}=n;e.formFieldsValue[o.tag]=t.target.value},xe=async n=>{var T;let o;n!=null&&n.isRecurring&&(o=n.isRecurring);const t=o!=null?o:(T=a.calendar)==null?void 0:T.enable_recurring;for(let S in e.phoneCountryIncluded)e.phoneCountryIncluded[S]&&Ae({tag:S});if(await It(e.formFieldsValue)>Ft){alert("The total size of the attached files cannot be more that 50MB");return}if(e.validationError={},console.log("captchaInputValue",oe.value),await Xr()||Qr())return;if(await Zr()&&(oe.value===void 0||oe.value==="0")){e.validationError.captcha="Invalid Captcha";return}let E;if(g("disableBackOnSubmit",{disable:!0}),Ie.value=!0,j.value="",Oe.value&&!Ue.value){E={},console.log(",s",{body:{locationId:a.formData.locationId,calendarId:a.calendar.id}});try{const{client_secret:S}=await $fetch(U.serverBaseUrl+"/appointment/setup-intent",{method:"POST",body:{locationId:a.formData.locationId,calendarId:a.calendar.id}});if(!S)throw j.value="Something went wrong while processing your payment, please try again.",new Error("clientSecret missing");let $,A;if(e.formFieldsValue.first_name&&(A=e.formFieldsValue.first_name.trim()),e.formFieldsValue.full_name&&(A=e.formFieldsValue.full_name.trim()),$=await ve.value.confirmCardSetup(S,{payment_method:{card:De.value,billing_details:A?{name:A}:{}}},{handleActions:!1}),$.error)throw j.value=$.error.message,$.error;{const M={...e.formFieldsValue};if(Q.value){let w;if(typeof Storage<"u")try{w=Re(h.value)}catch{console.error("Failed to fetch contact from local storage")}w||(w=kr(h.value).value),w&&(M.contact_id=w)}re.value&&(M.phone=re.value);const K={location_id:h.value,calendar_id:a.calendar.id,payment_method_id:$.setupIntent.payment_method,setup_intent_status:$.setupIntent.status,customer_data:M},x=await $fetch(U.serverBaseUrl+"/appointment/setup-stripe-customer-and-payment-intent",{method:"POST",body:K});if(x.status==="requires_action"){const w=await ve.value.handleCardAction(x.client_secret);if(w.error)throw j.value=w.error.message,w.error;E.payment_intent_id=w.paymentIntent.id}else E.payment_intent_id=x.id;E.stripe_customer_id=x.stripe_customer_id}}catch(S){return console.error(S),j.value||(j.value="Something went wrong while processing your payment, please try again."),g("disableBackOnSubmit",{disable:!1}),Ie.value=!1,!1}}const J=await Et(e.formFieldsValue,V.value);e.formFieldsValue=J.formFieldsValue;const W=await Pt(O,_.value,e.formFieldsValue);e.formFieldsValue=W.formFieldsValue,await lt(E,{isRecurring:t}),g("disableBackOnSubmit",{disable:!1})},at=n=>{const o={};for(const t in n)n.hasOwnProperty(t)&&(o[t.replace(/(\_\w)/g,function(i){return i[1].toUpperCase()})]=n[t]);return o},lt=async(n,{isRecurring:o})=>{var A,M,K,x,w,X,ae,le,ne,ie,se,de;if(a.formId&&(e.formFieldsValue.formId=a.formId),e.formFieldsValue.location_id=h.value,re.value&&(e.formFieldsValue.phone=re.value),Q.value){let l;if(a.stickyContactFingerprint&&(l=a.stickyContactFingerprint),!l&&typeof Storage<"u")try{l=Re(h.value)}catch{console.error("Failed to get contact from local storage")}l||(l=kr(h.value).value),l&&(e.formFieldsValue.contact_id=l)}const t=O.query.contact_id||((A=a.urlParams)==null?void 0:A.contact_id);t&&(e.formFieldsValue.query_contact_id=t);const i=e.formFieldsValue;let s=null;(M=a.calendar)!=null&&M.form_submit_type?a.calendar.form_submit_type==="RedirectURL"&&(s=a.calendar.form_submit_redirect_url||a.calendar.thank_you_url):((w=(x=(K=a.calendar)==null?void 0:K.thank_you_url)==null?void 0:x.trim())==null?void 0:w.length)>0&&(s=a.calendar.thank_you_url),a.event?i.event_id=O.query.event_id:a.calendarEventId&&(i.event_id=a.calendarEventId),a.calendar&&(i.calendar_id=a.calendar.id,i.selected_slot=a.selectedSlot.format(),i.selected_timezone=a.timezone),Ue.value?i.stripeToken=Ue.value:n&&(i.stripePaymentResult=n);const z=Ot(i.locationId);z&&(i.sessionId=z);const E=Dt();i.eventData={...Ut(a.pageUrl,a.baseReferrrer),fbEventId:E};let J=Tt(i.locationId);if(J&&(i.sessionFingerprint=J),a.funnelPreview){let{domain:l,page_url:p}=O.query;l||(l=window.location.hostname,p=window.location.pathname),i.funneEventData={event_type:"optin",domain_name:l,page_url:p,funnel_id:$e.value.funnelId,page_id:$e.value.funnelPageId,funnel_step_id:$e.value.stepId}}Te.value&&(i.captchaToken=Te.value);let W=U.REST_API_URLS+"/forms/submit";a.calendar&&(W=U.serverBaseUrl+"/appointment");let T=new FormData,S={};if(Object.keys(i).forEach(async l=>{var p;if(i[l]instanceof File)T.append(l,i[l]);else if((p=i[l])!=null&&p.files){const b=Object.values(i[l].files);b.length&&await Promise.all(b.map(P=>{T.append(l,P)}))}else S[l]=i[l]}),O.query.user_id&&(S.user_id=O.query.user_id),!o)T.set("formData",JSON.stringify(S)),$fetch(W,{method:"POST",body:T}).then(async l=>{if(console.log("Data",l),l.status||l.id){let p=l.formData,b=l.fingerprint,P=l.sessionFingerprint,f={};try{a.calendar&&(p=e.formFieldsValue,b=l.contactId);const y="_ud";f=await Fr(l.contact,!0),a.calendar&&(f={...f,appointment:l.appointment}),he(y,JSON.stringify(f)),he(h.value,b),window.parent.postMessage(["set-sticky-contacts",y,JSON.stringify(f),h.value,b],"*"),window.parent.postMessage(["set-sticky-contacts",`embedded_iframe_${a.iFrameId}`,a.iFrameId,h.value,b],"*"),a.event||(Vr({sessionId:l.sessionId||null,locationId:h.value}),P&&Ir(h.value,P)),g("onSubmit",{fingerprint:b})}catch(y){const L={formData:p||l,eventId:l.id,error:y.stack,isUserSessionLoad:window.userSessionAttribution,logs:window.ConsoleSubscriber?window.ConsoleSubscriber.getErrors():[]};await $fetch(U.serverBaseUrl+"/appointment/booking-error",{method:"POST",body:L})}if(a.calendar||fe(()=>{Er("track",e.form.formSubmissionEvent,E)}),a.calendar){const y={contactId:l.contactId,calendarThankYouUrl:s,id:l.id,fingerprint:b,event_address:l.event_address,cookiePayload:f,fbEventId:E};g("step",y);return}if(a.redirect===!1)return;if("formAction"in e.form&&parseInt(e.form.formAction.actionType)===1)window.top.location.href=_e(e.form.formAction.redirect_url,f);else if("redirect_url"in e.form&&e.form.redirect_url!=="")window.top.location.href=_e(e.form.redirect_url,f);else{ee.value=!0;const y=e.form.formAction.thankyouText?Cr(e.form.formAction.thankyouText,f):"Thanks for submiting details, Will get back to you soon!";te.value={action:"submit-form",message:y,isFormPosted:ee.value}}}}).catch(l=>{var p,b,P,f,y,L,ue;if(console.error("error",l),a.calendar){let Y="";((p=l==null?void 0:l.response)==null?void 0:p.status)===502?Y=((P=(b=l==null?void 0:l.response)==null?void 0:b.data)==null?void 0:P.msg)||"Something went wrong with your payment. Please try again.":(Y=((y=(f=l==null?void 0:l.response)==null?void 0:f.data)==null?void 0:y.msg)||B("unable_to_schedule_appointment"),Y=((ue=(L=l==null?void 0:l.response)==null?void 0:L.data)==null?void 0:ue.msg)||"unable_to_schedule_appointment"),g("processError",{error:Y})}});else try{S.source="booking_widget",S.channel="private_api";const l=await _o.createRecurringEvents(at(S));if(console.log("Data",l),l.ids&&l.ids.length){let p,b=l.fingerprint,P=l.sessionFingerprint,f={};try{a.calendar&&(p=e.formFieldsValue,b=l.contactId);const y="_ud";f=await Fr(l.contact,!0),a.calendar&&(f={...f,appointment:l.appointment}),he(y,JSON.stringify(f)),he(h.value,b),window.parent.postMessage(["set-sticky-contacts",y,JSON.stringify(f),h.value,b],"*"),window.parent.postMessage(["set-sticky-contacts",`embedded_iframe_${a.iFrameId}`,a.iFrameId,h.value,b],"*"),a.event||(Vr({sessionId:l.sessionId||null,locationId:h.value}),P&&Ir(h.value,P)),g("onSubmit",{fingerprint:b})}catch(y){const L={formData:p||l,eventId:l.ids.join(","),error:y.stack,isUserSessionLoad:window.userSessionAttribution,logs:window.ConsoleSubscriber?window.ConsoleSubscriber.getErrors():[]};await $fetch(U.serverBaseUrl+"/appointment/booking-error",{method:"POST",body:L})}if(a.calendar||fe(()=>{Er("track",e.form.formSubmissionEvent,E)}),a.calendar){const y={contactId:l.contactId,calendarThankYouUrl:s,ids:l.ids,fingerprint:b,event_address:l.eventAddress||"",cookiePayload:f,fbEventId:E};g("step",y);return}if(a.redirect===!1)return;if("formAction"in e.form&&parseInt(e.form.formAction.actionType)===1)window.top.location.href=_e(e.form.formAction.redirect_url,f);else if("redirect_url"in e.form&&e.form.redirect_url!=="")window.top.location.href=_e(e.form.redirect_url,f);else{ee.value=!0;const y=e.form.formAction.thankyouText?Cr(e.form.formAction.thankyouText,f):"Thanks for submiting details, Will get back to you soon!";te.value={action:"submit-form",message:y,isFormPosted:ee.value}}}}catch(l){if(console.error("error",l),a.calendar){let p="";((X=l==null?void 0:l.response)==null?void 0:X.status)===502?p=((le=(ae=l==null?void 0:l.response)==null?void 0:ae.data)==null?void 0:le.msg)||"Something went wrong with your payment. Please try again.":(p=((ie=(ne=l==null?void 0:l.response)==null?void 0:ne.data)==null?void 0:ie.msg)||B("unable_to_schedule_appointment"),p=((de=(se=l==null?void 0:l.response)==null?void 0:se.data)==null?void 0:de.msg)||"unable_to_schedule_appointment"),g("processError",{error:p})}}};return vt(()=>{Je.$off("submitCalendarForm",xe)}),(n,o)=>(c(),R("div",ko,[r(ee)?N("",!0):(c(),R("div",{key:0,id:"_builder-form",style:Fe({backgroundColor:"#"+r(e).formStyle.bgColor,color:"#"+r(e).formStyle.color,border:r(e).formStyle.border+"px "+r(e).formStyle.borderStyle+" #"+r(e).formStyle.borderColor,borderRadius:r(e).formStyle.radius+"px",maxWidth:r(e).formStyle.width+"px",marginTop:r(e).formStyle.marginTop?r(e).formStyle.marginTop:""}),name:"builder-form",class:ce(["form-builder--wrap",r(jr)])},[D("div",{class:ce([r(Ve)?"builder-inline":"",r(F)?"":"extra-top-padding","fields-container row"])},[(c(!0),R(bt,null,gt(r(_),(t,i)=>(c(),R("div",{key:i,class:ce([r(Ve)&&!rt(t.type)&&!et(t.tag)?"menu-field-wrap col-sm-6 col-6":"menu-field-wrap col-12",{calendar_notes:t.tag==="calendar_notes"},{"payment-block":t.type==="payment"}])},[D("div",{class:ce([i%2==0?"f-even":"f-odd","form-field-container"])},[t.type==="text"&&r(k)?(c(),v(xt,{key:0,kind:"form",item:t,"form-label-visible":r(F),"phone-country-included":r(e).phoneCountryIncluded,"phone-country-code":r(e).phoneCountryCode,"location-country":r(We),"form-fields-value":r(e).formFieldsValue,"formatted-phone":r(e).formattedPhone,"phone-country-derived":r(pe),errors:r(e).errors,onUpdatePhoneCountryDerived:Ke,onCustomFieldPhoneNumberUpdate:Ae,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","phone-country-included","phone-country-code","location-country","form-fields-value","formatted-phone","phone-country-derived","errors"])):t.type==="phone"&&r(k)?(c(),v(Rt,{key:1,kind:"form",item:t,"form-label-visible":r(F),"phone-country-included":r(e).phoneCountryIncluded,"phone-country-code":r(e).phoneCountryCode,"location-country":r(We),"phone-country-derived":r(pe),"formatted-phone":r(e).formattedPhone,errors:r(e).errors,onAddOrUpdateError:I,onUpdatePhoneCountryDerived:Ke,onCustomFieldPhoneNumberUpdate:Ae,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","phone-country-included","phone-country-code","location-country","phone-country-derived","formatted-phone","errors"])):(t.type==="number"||t.type==="numerical")&&r(k)?(c(),v(Bt,{key:2,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,errors:r(e).errors,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","errors"])):t.type==="email"&&r(k)?(c(),v(Mt,{key:3,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,errors:r(e).errors,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","errors"])):N("",!0),t.type==="h1"?(c(),v(eo,{key:4,item:t},null,8,["item"])):t.type==="textbox_list"&&r(k)?(c(),v(Lt,{key:5,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,"local-tag-id":r(H),errors:r(e).errors,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","local-tag-id","errors"])):(t.type==="textarea"||t.type=="large_text")&&r(k)?(c(),v(Nt,{key:6,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,errors:r(e).errors,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","errors"])):t.type==="img"&&"url"in t?(c(),v(ro,{key:7,kind:"form",item:t,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item"])):t.type==="html"?(c(),v(jt,{key:8,item:t,localTagId:r(H)+i,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","localTagId"])):t.type==="captcha"&&r(k)?(c(),v(qt,{key:9,kind:"form",item:t,"form-label-visible":r(F),"captcha-input-value":r(oe),"local-tag-id":r(H),"validation-error":r(e).validationError,onUpdateValidationError:qr,onUpdateIsCaptchaVerified:Kr,onUpdateCaptchaToken:Yr,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","captcha-input-value","local-tag-id","validation-error"])):t.type==="monetory"&&r(k)?(c(),v(zt,{key:10,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,"locale-currency":r(Lr),errors:r(e).errors,onAddOrUpdateError:I,onUpdateFormFieldsValue:be,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","locale-currency","errors"])):t.type==="checkbox"&&r(k)?(c(),v(Ht,{key:11,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,"local-tag-id":r(H),errors:r(e).errors,onAddOrUpdateError:I,onUpdateFormFieldsValue:be,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","local-tag-id","errors"])):t.type==="radio"&&t.picklistOptions&&r(k)?(c(),v(Jt,{key:12,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,"local-tag-id":r(H),errors:r(e).errors,onAddOrUpdateError:I,onResetFieldsValue:tt,onSetRadioValue:ot,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","local-tag-id","errors"])):t.type==="radio"&&t.picklistOptionsImage&&r(k)?(c(),v(Wt,{key:13,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,"local-tag-id":r(H),errors:r(e).errors,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","local-tag-id","errors"])):t.type==="select"&&t.tag=="country"&&r(k)?(c(),v(Kt,{key:14,kind:"form",item:t,"form-label-visible":r(F),"formatted-country":r(V),countries:r(Nr),errors:r(e).errors,onUpdateFormattedCountry:Wr,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","formatted-country","countries","errors"])):(t.type==="single_options"||t.type==="multiple_options")&&r(k)?(c(),v(Yt,{key:15,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,errors:r(e).errors,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-label-visible","form-fields-value","errors"])):t.type==="date"&&r(k)?(c(),v(Gt,{key:16,kind:"form",item:t,"form-label-visible":r(F),"form-fields-value":r(e).formFieldsValue,errors:r(e).errors,ref_for:!0,ref:s=>{r(m)[i]=s},onDateSelected:Gr,onAddOrUpdateError:I},null,8,["item","form-label-visible","form-fields-value","errors"])):t.type==="payment"&&r(k)?(c(),v(go,{key:17,calendar:d.calendar,payment:r(Oe),stripe:r(ve),card:r(De),"card-error-msg":r(j),onUpdateStripe:zr,onUpdateCard:Hr,onUpdateCardErrorMsg:Jr,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["calendar","payment","stripe","card","card-error-msg"])):t.type==="file_upload"&&r(k)?(c(),v(Qt,{key:18,kind:"form",item:t,"form-fields-value":r(e).formFieldsValue,"form-label-visible":r(F),errors:r(e).errors,onUpdateFormFieldsValue:be,onAddOrUpdateError:I,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","form-fields-value","form-label-visible","errors"])):t.type==="signature"&&r(k)?(c(),v(Xt,{key:19,kind:"form",item:t,"form-fields-value":r(e).formFieldsValue,"form-label-visible":r(F),ref_for:!0,ref:s=>{r(m)[i]=s},errors:r(e).errors,onUpdateFormFieldsValue:be,onAddOrUpdateError:I},null,8,["item","form-fields-value","form-label-visible","errors"])):t.type==="submit"&&r(k)?(c(),v(uo,{key:20,item:t,calendar:d.calendar,"form-submit-disable":r(Ie),"button-style":r(e).buttonStyle,onClick:xe,ref_for:!0,ref:s=>{r(m)[i]=s}},null,8,["item","calendar","form-submit-disable","button-style"])):N("",!0)],2)],2))),128))],2),d.formData!=null&&r(ze)&&!r(G)?(c(),v($t,{key:0,company:r(e).company},null,8,["company"])):N("",!0)],6)),r(te)&&r(te).isFormPosted?(c(),v(no,{key:1,id:"_builder-form",payload:r(te)},null,8,["payload"])):N("",!0)],512))}});export{_o as C,Eo as _};
